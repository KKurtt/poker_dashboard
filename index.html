<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GPC Poker League - 能力互评</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=Noto+Serif+SC:wght@300;500;700&family=Space+Mono:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">

    <style>
        :root {
            /* ============================================================
               【配色控制台】在这里调整全局绿色浓度
               ============================================================ */

            /* 1. 色相 (0=红, 120=绿, 150=青绿, 240=蓝)
               建议范围: 140 - 160 (偏冷绿) */
            --theme-hue: 50;
            --theme-hue-panel: 140;

            /* 2. 饱和度 (0%=灰, 100%=鲜艳)
               建议范围: 5% - 15% (越低越高级，越高越像黑客帝国) */
            --theme-sat: 8%;

            /* 3. 背景亮度 (越小越黑) */
            --bg-l-deep: 1%;   /* 网页背景黑度 */
            --bg-l-panel: 5%;  /* 卡片背景黑度 */

            /* ============================================================ */

            /* 基于上述参数生成的颜色 (无需修改) */
            --bg-deep: hsl(var(--theme-hue), var(--theme-sat), var(--bg-l-deep));
            --bg-panel: hsla(var(--theme-hue-panel), var(--theme-sat), var(--bg-l-panel), 0.85);

            /* 装饰光晕颜色 */
            --glow-color: hsla(var(--theme-hue), 20%, 20%, 1);

            --border-color: rgba(180, 160, 120, 0.15); /* 极细金线，更淡 */
            --border-highlight: rgba(197, 160, 89, 0.5);

            --accent-gold: #C5A059;
            --accent-glow: rgba(197, 160, 89, 0.2);

            --text-main: #d0d0d0;
            --text-muted: #707570;

            --font-heading: 'Cinzel', 'Noto Serif SC', 'Songti SC', serif;
            --font-data: 'Space Mono', 'PingFang SC', 'Microsoft YaHei', sans-serif;

            --header-height: 70px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: var(--font-data);
            background-color: var(--bg-deep);
            color: var(--text-main);
            line-height: 1.6;
            overflow-x: hidden;
            padding-bottom: 100px;
            position: relative;
        }

        /* 背景光晕 - 使用 CSS 变量控制 */
        body::before {
            content: ""; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at 50% 0%, var(--glow-color) 0%, var(--bg-deep) 70%);
            z-index: -1;
            pointer-events: none;
            opacity: 0.6; /* 再次降低光晕强度 */
        }

        /* --- 顶部悬浮栏 --- */
        .sticky-header {
            position: fixed; top: 0; left: 0; width: 100%; height: var(--header-height);
            background: rgba(5, 5, 5, 0.95);
            border-bottom: 1px solid var(--border-color);
            z-index: 1000;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 20px;
            transform: translateY(-100%);
            transition: transform 0.5s cubic-bezier(0.16, 1, 0.3, 1);
            box-shadow: 0 10px 30px rgba(0,0,0,0.8);
        }
        .sticky-header.visible { transform: translateY(0); }

        .sticky-logo { height: 40px; width: auto; display: block; }

        .sticky-select-wrapper { flex-grow: 1; display: flex; justify-content: flex-end; }
        .sticky-select {
            background: transparent; color: var(--accent-gold); border: 1px solid var(--border-color);
            padding: 6px 15px; font-family: var(--font-heading); font-size: 0.9rem; outline: none; border-radius: 0;
        }

        /* --- 主容器 --- */
        .container { max-width: 1100px; margin: 0 auto; padding: 40px 20px; position: relative; z-index: 1; }

        header { text-align: center; margin-bottom: 60px; padding-top: 20px; position: relative; }
        header::after {
            content: ""; display: block; width: 1px; height: 50px;
            background: linear-gradient(to bottom, transparent, var(--accent-gold), transparent);
            margin: 25px auto 0; opacity: 0.3;
        }

        .main-logo-wrapper { margin-bottom: 20px; display: flex; justify-content: center; }
        .main-logo { max-width: 220px; height: auto; }

        h1 {
            font-family: var(--font-heading); font-size: 2.2rem; color: var(--text-main);
            text-transform: uppercase; letter-spacing: 0.15em; margin-bottom: 10px; font-weight: 500;
            text-shadow: 0 0 20px rgba(197, 160, 89, 0.1);
        }
        @media (max-width: 768px) { h1 { font-size: 1.6rem; letter-spacing: 0.1em; } }

        .subtitle { font-family: var(--font-heading); color: var(--text-muted); font-size: 1.5rem; letter-spacing: 0.1em; }

        /* 主选择器 */
        .selector-wrapper { display: flex; justify-content: center; margin-bottom: 50px; position: relative; z-index: 10; }
        .custom-select { position: relative; width: 100%; max-width: 320px; }
        .custom-select select {
            appearance: none; -webkit-appearance: none; width: 100%;
            font-family: var(--font-heading); font-size: 1.1rem; letter-spacing: 0.1em;
            padding: 15px 20px; background-color: rgba(0, 0, 0, 0.5);
            border: 1px solid var(--border-color); color: var(--accent-gold);
            cursor: pointer; outline: none; transition: all 0.4s ease; text-align: center; border-radius: 0;
        }
        .custom-select select:hover { border-color: var(--border-highlight); box-shadow: 0 0 15px var(--accent-glow); }
        .custom-select::after {
            content: '▼'; font-size: 0.7rem; color: var(--accent-gold);
            position: absolute; right: 15px; top: 50%; transform: translateY(-50%); pointer-events: none;
        }

        /* --- 仪表盘 --- */
        .dashboard { display: grid; grid-template-columns: 1fr; gap: 40px; }
        @media (min-width: 900px) { .dashboard { grid-template-columns: 1fr 1fr; gap: 50px; } .full-width { grid-column: span 2; } }

        .card {
            background: var(--bg-panel); border: 1px solid var(--border-color); padding: 30px;
            position: relative; transition: border-color 0.3s; box-shadow: 0 20px 50px rgba(0,0,0,0.6);
        }
        .card::before, .card::after {
            content: ""; position: absolute; width: 8px; height: 8px; border: 1px solid var(--accent-gold); transition: all 0.3s; opacity: 0.5;
        }
        .card::before { top: -1px; left: -1px; border-right: none; border-bottom: none; }
        .card::after { bottom: -1px; right: -1px; border-left: none; border-top: none; }
        .card:hover { border-color: var(--border-highlight); }

        .card-title {
            font-family: var(--font-heading); color: var(--text-main); font-size: 1.2rem;
            margin-bottom: 30px; border-bottom: 1px solid rgba(255,255,255,0.05);
            padding-bottom: 15px; display: flex; justify-content: space-between; align-items: baseline; flex-wrap: wrap; gap: 10px;
            letter-spacing: 0.05em; font-weight: 500;
        }
        .card-sub { font-family: var(--font-data); font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0; }

        .rolling-number { font-family: 'Space Mono', monospace; color: var(--accent-gold); }

        .chart-container { position: relative; height: 320px; width: 100%; }
        @media (min-width: 768px) { .chart-container { height: 380px; } }

        .scatter-wrapper { position: relative; height: 320px; width: 100%; padding: 20px; }
        @media (min-width: 768px) { .scatter-wrapper { height: 380px; } }

        .quadrant-label {
            position: absolute; display: flex; align-items: center; justify-content: center; gap: 8px;
            color: var(--text-muted); font-size: 11px; pointer-events: none; z-index: 10;
            font-family: var(--font-data); letter-spacing: 1px; opacity: 0.7;
        }
        .axis-arrow { width: 30px; height: 8px; fill: none; stroke: var(--text-muted); stroke-width: 1; opacity: 0.5; }
        .q-bottom { bottom: 0; left: 0; width: 100%; }
        .q-left { top: 50%; left: 0; transform: translate(-42%, -50%) rotate(-90deg); transform-origin: center center; width: auto; white-space: nowrap; }

        /* Data Breakdown */
        .detail-rows { display: flex; flex-direction: column; gap: 25px; }
        .detail-row { display: flex; flex-direction: column; padding-bottom: 5px; }
        .row-header { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 12px; }
        .d-label { font-family: var(--font-heading); font-size: 1rem; color: var(--text-main); letter-spacing: 0.1em; font-weight: 300; }
        .d-stats { font-size: 0.75rem; color: var(--text-muted); font-family: var(--font-data); }
        .stat-item { display: inline-block; margin-left: 15px; }
        .stat-label-small { font-size: 0.7rem; opacity: 0.6; margin-right: 2px; }
        .stat-val { color: var(--text-main); font-weight: 400; }
        .stat-gap { color: var(--accent-gold); }
        .d-track-container { position: relative; width: 100%; height: 20px; display: flex; align-items: center; }
        .d-track-line { width: 100%; height: 1px; background: rgba(255,255,255,0.1); }

        .detail-point { position: absolute; top: 50%; transform: translate(-50%, -50%); transition: left 1.5s cubic-bezier(0.22, 1, 0.36, 1); }
        .detail-point.peer { width: 3px; height: 3px; border-radius: 50%; background-color: rgba(255, 255, 255, 0.4); box-shadow: 0 0 4px rgba(255, 255, 255, 0.2); z-index: 1; }
        .detail-point.self { width: 7px; height: 7px; background: var(--accent-gold); transform: translate(-50%, -50%) rotate(45deg); border: 1px solid #000; z-index: 2; box-shadow: 0 0 8px var(--accent-glow); }

        .ai-advice { font-family: var(--font-data); font-size: 0.9rem; color: #a0a0a0; line-height: 1.9; border-left: 1px solid var(--accent-gold); padding-left: 25px; margin-left: 5px; }
        .ai-advice strong { color: var(--accent-gold); font-weight: 400; font-family: var(--font-heading); letter-spacing: 0.05em; }
        .ai-advice p { margin-bottom: 15px; text-align: justify; }
        .ai-advice ul { padding-left: 15px; margin-bottom: 15px; list-style-type: none; }
        .ai-advice li { margin-bottom: 8px; color: var(--text-muted); position: relative; padding-left: 15px; }
        .ai-advice li::before { content: ">"; position: absolute; left: -5px; color: var(--accent-gold); font-size: 0.8rem;}

        footer { height: 100px; display: flex; justify-content: center; align-items: center; opacity: 0.3; font-size: 0.7rem; font-family: var(--font-data); letter-spacing: 2px;}
    </style>
</head>
<body>

<div class="sticky-header" id="stickyHeader">
    <img src="logo_sticky.png" alt="GPC Logo" class="sticky-logo">
    <div class="sticky-select-wrapper">
        <select id="stickyPlayerSelect" class="sticky-select"></select>
    </div>
</div>

<div class="container">
    <header id="mainHeader">
        <div class="main-logo-wrapper">
            <img src="logo_main.png" alt="GPC Main Logo" class="main-logo">
        </div>
        <h1>GPC POKER LEAGUE</h1>
        <div class="subtitle">S1 赛季能力互评报告</div>
    </header>

    <div class="selector-wrapper">
        <div class="custom-select">
            <select id="playerSelect"></select>
        </div>
    </div>

    <div class="dashboard" id="dashboard">

        <!-- 1. 雷达图 -->
        <div class="card">
            <div class="card-title">
                综合能力雷达
                <span class="card-sub">Radar Analysis</span>
            </div>
            <div class="chart-container">
                <canvas id="radarChart"></canvas>
            </div>
        </div>

        <!-- 2. 象限图 -->
        <div class="card">
            <div class="card-title">
                选手风格定位
                <span class="card-sub">Player Profiling</span>
            </div>

            <div class="scatter-wrapper">
                <div class="quadrant-label q-bottom">
                    <span>松 (Loose)</span>
                    <svg class="axis-arrow" viewBox="0 0 60 12"><line x1="0" y1="6" x2="60" y2="6" /></svg>
                    <span>紧 (Tight)</span>
                </div>
                <div class="quadrant-label q-left">
                    <span>弱 (Passive)</span>
                    <svg class="axis-arrow" viewBox="0 0 60 12"><line x1="0" y1="6" x2="60" y2="6" /></svg>
                    <span>凶 (Aggressive)</span>
                </div>
                <canvas id="scatterChart"></canvas>
            </div>

            <!-- 这里的文字现在由 JSON 直接控制 -->
            <div id="profileText" style="margin-top:20px; text-align:center; color:var(--accent-gold); font-family: var(--font-heading); font-size: 1rem; letter-spacing: 0.1em; min-height: 1.6em;"></div>
        </div>

        <!-- 3. 评分细节 -->
        <div class="card full-width">
            <div class="card-title">
                评分分布细节
                <!-- MAE 数值现在由 JSON 直接控制 -->
                <span class="card-sub">
                    认知偏差 (MAE): <span id="maeValue" class="rolling-number" style="font-weight:bold; font-size:1.1rem;">0.0</span>
                </span>
            </div>
            <div class="detail-rows" id="detailRows"></div>
        </div>

        <!-- 4. AI 建议 -->
        <div class="card full-width">
            <div class="card-title">AI 战术顾问建议</div>
            <div class="ai-advice" id="aiAdvice"></div>
        </div>

    </div>

    <footer>
        GPC SYSTEM // END OF RECORD
    </footer>
</div>

<script>
    // ============================================================================
    // 数据配置区域 (现在包含 MAE 和 画像文字)
    // ============================================================================

    const dimensions = ["范围构建", "锦标赛ICM", "激进偷盲", "读牌能力", "数学理论", "心态耐力"];

    const playersData = [
        {
            id: "01 Viper (毒蛇)",
            mae: "0.8",
            profileLabel: "综合画像判定：紧凶型 (TAG)",
            abilities: [
                { self: 9, others: [8, 9, 8, 7, 9, 8, 9, 8, 7] }, // 读牌
                { self: 8, others: [7, 8, 8, 6, 7, 8, 7, 8, 9] }, // 诈唬
                { self: 9, others: [9, 9, 8, 9, 9, 8, 9, 9, 8] }, // 算率
                { self: 7, others: [6, 7, 5, 6, 7, 6, 7, 5, 6] }, // 资金
                { self: 8, others: [8, 7, 8, 9, 8, 7, 8, 8, 7] }, // 心理
                { self: 9, others: [9, 8, 9, 9, 8, 9, 8, 9, 9] }  // 学习
            ],
            profile: {
                tightness: { self: 8.5, others: [8, 9, 8, 7, 9, 8, 8, 9, 7] },
                aggression: { self: 9.0, others: [8, 9, 9, 8, 9, 9, 8, 9, 8] }
            },
            aiAdvice: `
                <p><strong>综合评价：</strong>典型的鲨鱼玩家，各项数据非常顶尖。你的<strong>数学计算</strong>和<strong>学习能力</strong>是团队的核心资产。</p>
                <p><strong>战术建议：</strong></p>
                <ul>
                    <li>你的形象过于“扎实”，导致诈唬成功率极高，但很难获得大底池支付。建议偶尔在干燥面展示一些非标准的手牌。</li>
                    <li>资金管理评分略有波动，注意在高额桌的情绪控制。</li>
                </ul>
            `
        },
        {
            id: "02 MadMax (疯子)",
            mae: "2.4",
            profileLabel: "综合画像判定：松凶型 (LAG)",
            abilities: [
                { self: 8, others: [5, 6, 4, 7, 5, 6, 4, 5, 6] },
                { self: 10, others: [9, 10, 9, 8, 10, 9, 9, 10, 8] }, // 极度擅长诈唬
                { self: 6, others: [4, 5, 3, 4, 5, 4, 3, 5, 4] },
                { self: 9, others: [2, 3, 2, 4, 3, 2, 3, 2, 4] }, // 资金管理极差
                { self: 7, others: [5, 6, 4, 5, 6, 5, 4, 6, 5] },
                { self: 5, others: [4, 3, 4, 5, 4, 3, 4, 5, 4] }
            ],
            profile: {
                tightness: { self: 3.0, others: [2, 3, 2, 4, 2, 3, 2, 3, 2] }, // 非常松
                aggression: { self: 9.5, others: [10, 9, 10, 9, 10, 9, 10, 9, 10] } // 非常凶
            },
            aiAdvice: `
                <p><strong>综合评价：</strong>你是牌桌上的炸药桶，给对手制造了巨大的压力。你的<strong>诈唬频率</strong>极高，但基础数学跑分较低。</p>
                <p><strong>战术建议：</strong></p>
                <ul>
                    <li>队友普遍认为你的资金管理存在巨大风险（平均分仅为2.8），请务必建立止损线。</li>
                    <li>尝试减少翻前的入池率（VPIP），将侵略性更多地保留在翻后有位置的时候。</li>
                </ul>
            `
        },
        {
            id: "03 Rocky (磐石)",
            mae: "1.1",
            profileLabel: "综合画像判定：紧弱型 (Nit)",
            abilities: [
                { self: 7, others: [6, 7, 6, 7, 6, 7, 6, 7, 6] },
                { self: 3, others: [2, 3, 2, 3, 2, 3, 2, 3, 2] }, // 几乎不诈唬
                { self: 8, others: [7, 8, 7, 8, 7, 8, 7, 8, 7] },
                { self: 9, others: [9, 9, 8, 9, 9, 8, 9, 9, 9] }, // 资金管理极好
                { self: 6, others: [5, 6, 5, 6, 5, 6, 5, 6, 5] },
                { self: 7, others: [6, 7, 6, 7, 6, 7, 6, 7, 6] }
            ],
            profile: {
                tightness: { self: 9.0, others: [9, 9, 8, 9, 9, 9, 8, 9, 9] },
                aggression: { self: 3.0, others: [2, 3, 2, 3, 2, 3, 2, 3, 2] }
            },
            aiAdvice: `
                <p><strong>综合评价：</strong>你是最稳健的防守者，几乎不会犯大错。但你的打法过于诚实，容易被对手通过弃牌剥削。</p>
                <p><strong>战术建议：</strong></p>
                <ul>
                    <li>你的“诚实度”太高了，当你在河牌下注时，对手几乎都会弃牌，导致你拿不到价值。</li>
                    <li>建议在有利位置时，适当拓宽你的冷跟注（Cold Call）范围，增加一些不可预测性。</li>
                </ul>
            `
        },
        {
            id: "04 Joker (小丑)",
            mae: "3.5", // 认知偏差巨大
            profileLabel: "综合画像判定：自我认知偏差型",
            abilities: [
                { self: 9, others: [4, 5, 3, 6, 4, 5, 3, 4, 5] }, // 自认读牌神，别人觉得菜
                { self: 8, others: [3, 4, 2, 5, 3, 4, 2, 3, 4] },
                { self: 7, others: [5, 6, 5, 6, 5, 6, 5, 6, 5] },
                { self: 8, others: [4, 5, 4, 5, 4, 5, 4, 5, 4] },
                { self: 9, others: [2, 3, 2, 4, 2, 3, 2, 3, 2] }, // 心态极差，容易上头
                { self: 6, others: [5, 6, 5, 6, 5, 6, 5, 6, 5] }
            ],
            profile: {
                tightness: { self: 7.0, others: [3, 4, 3, 4, 3, 4, 3, 4, 3] }, // 自认紧，实际松
                aggression: { self: 8.0, others: [7, 8, 6, 7, 8, 7, 6, 8, 7] }
            },
            aiAdvice: `
                <p><strong>综合评价：</strong>数据警报！你的自我评分（MAE 3.5）与队友评价存在巨大鸿沟。你认为自己是紧凶高手，但数据表明你打得非常松。</p>
                <p><strong>战术建议：</strong></p>
                <ul>
                    <li><strong>心态管理</strong>是你的首要任务，队友评分显示你在逆风局极易崩溃（评分2-3）。</li>
                    <li>请重新审视你的起手牌范围图表，严格执行翻前纪律，不要过度高估边缘牌的价值。</li>
                </ul>
            `
        },
        {
            id: "05 Whale (老板)",
            mae: "1.8",
            profileLabel: "综合画像判定：松弱型 (Fish)",
            abilities: [
                { self: 5, others: [3, 4, 3, 4, 3, 4, 3, 4, 3] },
                { self: 4, others: [2, 3, 2, 3, 2, 3, 2, 3, 2] },
                { self: 3, others: [2, 2, 3, 2, 2, 3, 2, 2, 3] },
                { self: 10, others: [10, 10, 10, 10, 10, 10, 10, 10, 10] }, // 很有钱
                { self: 8, others: [8, 9, 8, 9, 8, 9, 8, 9, 8] }, // 心态很好，输得起
                { self: 4, others: [3, 4, 3, 4, 3, 4, 3, 4, 3] }
            ],
            profile: {
                tightness: { self: 4.0, others: [2, 3, 2, 3, 2, 3, 2, 3, 2] },
                aggression: { self: 4.0, others: [2, 3, 2, 3, 2, 3, 2, 3, 2] }
            },
            aiAdvice: `
                <p><strong>综合评价：</strong>你是牌桌上最受欢迎的玩家，心态极好，资金充裕。但技术层面存在明显的漏洞，入池率过高且缺乏攻击性。</p>
                <p><strong>战术建议：</strong></p>
                <ul>
                    <li>学会弃掉顶对弱踢脚（Top Pair Weak Kicker），这是你最大的输钱来源。</li>
                    <li>尝试在翻牌前进行加注，而不是永远只是跟注（Limp），掌握主动权。</li>
                </ul>
            `
        },
        {
            id: "06 Ace (王牌)",
            mae: "0.3",
            profileLabel: "综合画像判定：GTO 均衡型",
            abilities: [
                { self: 8, others: [8, 8, 9, 8, 8, 9, 8, 8, 9] },
                { self: 8, others: [8, 8, 8, 8, 8, 8, 8, 8, 8] },
                { self: 9, others: [9, 9, 9, 9, 9, 9, 9, 9, 9] },
                { self: 8, others: [8, 8, 8, 8, 8, 8, 8, 8, 8] },
                { self: 9, others: [9, 9, 9, 9, 9, 9, 9, 9, 9] },
                { self: 9, others: [9, 9, 9, 9, 9, 9, 9, 9, 9] }
            ],
            profile: {
                tightness: { self: 7.5, others: [7, 8, 7, 8, 7, 8, 7, 8, 7] },
                aggression: { self: 7.5, others: [7, 8, 7, 8, 7, 8, 7, 8, 7] }
            },
            aiAdvice: `
                <p><strong>综合评价：</strong>完美的六边形战士。你的各项指标都非常均衡，几乎没有短板，打法接近 GTO（博弈论最优）。</p>
                <p><strong>战术建议：</strong></p>
                <ul>
                    <li>在面对明显有漏洞的对手（如 MadMax 或 Whale）时，建议暂时偏离 GTO 策略，采用剥削性打法以最大化收益。</li>
                    <li>保持现状，你是团队的中流砥柱。</li>
                </ul>
            `
        },
        {
            id: "07 Shadow (影子)",
            mae: "0.9",
            profileLabel: "综合画像判定：中庸偏紧型",
            abilities: [
                { self: 6, others: [5, 6, 5, 6, 5, 6, 5, 6, 5] },
                { self: 5, others: [4, 5, 4, 5, 4, 5, 4, 5, 4] },
                { self: 7, others: [6, 7, 6, 7, 6, 7, 6, 7, 6] },
                { self: 6, others: [6, 6, 6, 6, 6, 6, 6, 6, 6] },
                { self: 7, others: [7, 7, 7, 7, 7, 7, 7, 7, 7] },
                { self: 6, others: [5, 6, 5, 6, 5, 6, 5, 6, 5] }
            ],
            profile: {
                tightness: { self: 6.5, others: [6, 7, 6, 7, 6, 7, 6, 7, 6] },
                aggression: { self: 5.0, others: [4, 5, 4, 5, 4, 5, 4, 5, 4] }
            },
            aiAdvice: `
                <p><strong>综合评价：</strong>你的存在感较低，但这有时是一种优势。你很少犯错，但也缺乏创造力，很难在深筹码时清空对手。</p>
                <p><strong>战术建议：</strong></p>
                <ul>
                    <li>增加过牌-加注（Check-Raise）的频率，不要让对手便宜地看牌。</li>
                    <li>在盲注保卫战中可以更加激进一些。</li>
                </ul>
            `
        },
        {
            id: "08 Fox (狐狸)",
            mae: "1.2",
            profileLabel: "综合画像判定：狡猾多变型",
            abilities: [
                { self: 8, others: [7, 8, 6, 9, 7, 8, 6, 9, 7] }, // 评价两极分化
                { self: 9, others: [8, 9, 7, 9, 8, 9, 7, 9, 8] },
                { self: 6, others: [5, 6, 5, 6, 5, 6, 5, 6, 5] },
                { self: 7, others: [6, 7, 6, 7, 6, 7, 6, 7, 6] },
                { self: 8, others: [7, 8, 7, 8, 7, 8, 7, 8, 7] },
                { self: 7, others: [6, 7, 6, 7, 6, 7, 6, 7, 6] }
            ],
            profile: {
                tightness: { self: 5.5, others: [4, 6, 5, 7, 4, 6, 5, 7, 5] }, // 档位切换频繁
                aggression: { self: 7.0, others: [6, 8, 6, 8, 6, 8, 6, 8, 6] }
            },
            aiAdvice: `
                <p><strong>综合评价：</strong>你非常擅长变换节奏，让对手难以捉摸。队友对你的评价方差很大，说明你成功地混淆了视听。</p>
                <p><strong>战术建议：</strong></p>
                <ul>
                    <li>注意不要为了“多变”而多变，所有的混合策略（Mixing Strategy）都应该建立在数学期望之上。</li>
                    <li>加强对底池赔率的计算，有时你的操作虽然秀，但数学上是负EV的。</li>
                </ul>
            `
        },
        {
            id: "09 T-800 (机器)",
            mae: "0.2",
            profileLabel: "综合画像判定：ABC 标准型",
            abilities: [
                { self: 7, others: [7, 7, 7, 7, 7, 7, 7, 7, 7] },
                { self: 6, others: [6, 6, 6, 6, 6, 6, 6, 6, 6] },
                { self: 8, others: [8, 8, 8, 8, 8, 8, 8, 8, 8] },
                { self: 8, others: [8, 8, 8, 8, 8, 8, 8, 8, 8] },
                { self: 9, others: [9, 9, 9, 9, 9, 9, 9, 9, 9] }, // 极其冷静
                { self: 7, others: [7, 7, 7, 7, 7, 7, 7, 7, 7] }
            ],
            profile: {
                tightness: { self: 8.0, others: [8, 8, 8, 8, 8, 8, 8, 8, 8] },
                aggression: { self: 6.0, others: [6, 6, 6, 6, 6, 6, 6, 6, 6] }
            },
            aiAdvice: `
                <p><strong>综合评价：</strong>你像机器人一样执行策略，情绪极其稳定，从不 Tilt。你是低级别牌桌的收割机，但在高级别容易被针对。</p>
                <p><strong>战术建议：</strong></p>
                <ul>
                    <li>你的打法太容易被预测了（ABC Poker）。在面对思考层级较高的对手时，需要引入一些平衡范围的操作。</li>
                    <li>尝试在干燥面进行更多的持续下注（C-Bet）。</li>
                </ul>
            `
        },
        {
            id: "10 Phoenix (凤凰)",
            mae: "1.5",
            profileLabel: "综合画像判定：激进翻盘型",
            abilities: [
                { self: 7, others: [6, 7, 5, 8, 6, 7, 5, 8, 6] },
                { self: 8, others: [7, 9, 6, 8, 7, 9, 6, 8, 7] },
                { self: 6, others: [5, 6, 5, 6, 5, 6, 5, 6, 5] },
                { self: 5, others: [4, 5, 4, 5, 4, 5, 4, 5, 4] }, // 资金波动大
                { self: 9, others: [8, 9, 9, 9, 8, 9, 9, 9, 8] }, // 逆境心态极强
                { self: 8, others: [7, 8, 7, 8, 7, 8, 7, 8, 7] }
            ],
            profile: {
                tightness: { self: 4.5, others: [3, 5, 4, 6, 3, 5, 4, 6, 4] },
                aggression: { self: 8.5, others: [8, 9, 8, 9, 8, 9, 8, 9, 8] }
            },
            aiAdvice: `
                <p><strong>综合评价：</strong>你拥有一颗大心脏，经常在短码时上演奇迹翻盘。你的风格极具侵略性，擅长给对手施压。</p>
                <p><strong>战术建议：</strong></p>
                <ul>
                    <li>虽然你擅长翻盘，但最好不要让自己频繁陷入短码状态。前期阶段请打得更稳健一些。</li>
                    <li>注意泡沫期（Bubble）的ICM压力，不要在没有弃牌率的时候全下。</li>
                </ul>
            `
        }
    ];

    // ============================================================================
    // 逻辑代码
    // ============================================================================

    const teamAverages = dimensions.map((_, idx) => {
        let sum = 0, count = 0;
        playersData.forEach(p => {
            sum += p.abilities[idx].self;
            count++;
            p.abilities[idx].others.forEach(v => { sum += v; count++; });
        });
        return (sum / count).toFixed(1);
    });

    function animateValue(obj, start, end, duration) {
        if (!obj) return;
        let startTimestamp = null;
        const step = (timestamp) => {
            if (!startTimestamp) startTimestamp = timestamp;
            const progress = Math.min((timestamp - startTimestamp) / duration, 1);
            const easeProgress = 1 - Math.pow(1 - progress, 4);
            const currentVal = (start + (end - start) * easeProgress);
            obj.innerText = currentVal.toFixed(1);
            if (progress < 1) { window.requestAnimationFrame(step); }
            else { obj.innerText = end; } // 直接显示最终字符串
        };
        window.requestAnimationFrame(step);
    }

    let radarChart = null;
    let scatterChart = null;
    const playerSelect = document.getElementById('playerSelect');
    const stickySelect = document.getElementById('stickyPlayerSelect');
    const stickyHeader = document.getElementById('stickyHeader');
    const mainHeader = document.getElementById('mainHeader');
    const detailRows = document.getElementById('detailRows');
    const aiAdvice = document.getElementById('aiAdvice');
    const profileText = document.getElementById('profileText');
    const maeValueDisplay = document.getElementById('maeValue');

    function populateSelects() {
        playersData.forEach((p, index) => {
            const opt1 = document.createElement('option'); opt1.value = index; opt1.innerText = p.id; playerSelect.appendChild(opt1);
            const opt2 = document.createElement('option'); opt2.value = index; opt2.innerText = p.id; stickySelect.appendChild(opt2);
        });
    }
    populateSelects();

    function handlePlayerChange(index) {
        playerSelect.value = index;
        stickySelect.value = index;
        updateDashboard(index);
    }

    playerSelect.addEventListener('change', (e) => handlePlayerChange(e.target.value));
    stickySelect.addEventListener('change', (e) => handlePlayerChange(e.target.value));

    window.addEventListener('scroll', () => {
        if (window.scrollY > mainHeader.offsetHeight + 20) stickyHeader.classList.add('visible');
        else stickyHeader.classList.remove('visible');
    });

    Chart.defaults.color = '#707570';
    Chart.defaults.borderColor = 'rgba(255,255,255,0.05)';
    Chart.defaults.font.family = "'Space Mono', 'PingFang SC', sans-serif";

    function initDetailRows() {
        const allLabels = [...dimensions, "松紧倾向", "激进倾向"];
        allLabels.forEach((label, i) => {
            const row = document.createElement('div'); row.className = 'detail-row'; row.dataset.index = i;
            row.innerHTML = `
                <div class="row-header">
                    <div class="d-label">${label}</div>
                    <div class="d-stats">
                        <span class="stat-item"><span class="stat-label-small">自</span><span class="stat-val" id="row-${i}-val-self">0</span></span>
                        <span class="stat-item"><span class="stat-label-small">他</span><span class="stat-val" id="row-${i}-val-other">0</span></span>
                        <span class="stat-item"><span class="stat-label-small">差</span><span class="stat-gap" id="row-${i}-val-diff">0</span></span>
                    </div>
                </div>
                <div class="d-track-container">
                    <div class="d-track-line"></div>
                    ${Array.from({length:20}).map((_,j) => `<div class="detail-point peer" id="row-${i}-peer-${j}" style="display:none; left:50%"></div>`).join('')}
                    <div class="detail-point self" id="row-${i}-self" style="left:50%"></div>
                </div>
            `;
            detailRows.appendChild(row);
        });
    }
    initDetailRows();

    function updateDashboard(index) {
        const player = playersData[index];
        updateRadar(player);
        updateScatter(index); // Pass index to handle ghosting
        updateDetails(player);

        // 更新文字信息
        aiAdvice.innerHTML = player.aiAdvice;

        profileText.style.opacity = 0;
        setTimeout(() => {
            profileText.innerText = player.profileLabel;
            profileText.style.transition = 'opacity 0.8s';
            profileText.style.opacity = 1;
        }, 200);

        maeValueDisplay.innerText = player.mae;
    }

    function updateRadar(player) {
        const ctx = document.getElementById('radarChart').getContext('2d');
        const selfData = player.abilities.map(a => a.self);
        const otherAvgData = player.abilities.map(a => (a.others.reduce((x,y)=>x+y,0)/a.others.length).toFixed(1));

        // 极淡的金色渐变
        const gradientSelf = ctx.createRadialGradient(200, 200, 0, 200, 200, 200);
        gradientSelf.addColorStop(0, 'rgba(197, 160, 89, 0.2)'); // 非常淡
        gradientSelf.addColorStop(1, 'rgba(197, 160, 89, 0.05)');

        if (radarChart) {
            radarChart.data.datasets[0].data = selfData;
            radarChart.data.datasets[1].data = otherAvgData;
            radarChart.update({ duration: 1500, easing: 'easeInOutQuart' });
        } else {
            radarChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: dimensions,
                    datasets: [
                        {
                            label: '自评', data: selfData,
                            borderColor: '#C5A059', backgroundColor: gradientSelf,
                            borderWidth: 2, pointBackgroundColor: '#000', pointBorderColor: '#C5A059', pointBorderWidth: 2, pointRadius: 4, order: 1
                        },
                        {
                            label: '他评', data: otherAvgData,
                            borderColor: '#707570', backgroundColor: 'transparent',
                            borderDash: [3, 3], borderWidth: 1, pointBackgroundColor: '#707570', pointRadius: 2, order: 2
                        },
                        {
                            label: '战队平均', data: teamAverages,
                            borderColor: 'transparent', backgroundColor: 'rgba(255, 255, 255, 0.03)', pointRadius: 0, fill: true, order: 3
                        }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    scales: {
                        r: {
                            angleLines: { color: 'rgba(255,255,255,0.03)' },
                            grid: { color: 'rgba(255,255,255,0.03)', circular: true },
                            pointLabels: { color: '#d0d0d0', font: { size: 12, family: "'Noto Serif SC', serif" } },
                            suggestedMin: 0, suggestedMax: 10, ticks: { display: false, stepSize: 2 }
                        }
                    },
                    plugins: {
                        legend: { labels: { color: '#707570', font: { family: "'Noto Serif SC', serif" }, boxWidth: 8, usePointStyle: true } }
                    }
                }
            });
        }
    }

    function updateScatter(selectedIndex) {
        const ctx = document.getElementById('scatterChart').getContext('2d');
        const currentId = parseInt(selectedIndex);

        // 准备数据
        const allSelfPoints = [];
        const allOtherPoints = [];

        playersData.forEach((p, idx) => {
            const avgTight = p.profile.tightness.others.reduce((a,b)=>a+b,0) / p.profile.tightness.others.length;
            const avgAgg = p.profile.aggression.others.reduce((a,b)=>a+b,0) / p.profile.aggression.others.length;

            allSelfPoints.push({ x: p.profile.tightness.self, y: p.profile.aggression.self, pIndex: idx });
            allOtherPoints.push({ x: avgTight, y: avgAgg, pIndex: idx });
        });

        // === 核心：光晕插件 ===
        const glowPlugin = {
            id: 'glowEffect',
            beforeDatasetsDraw: (chart) => {
                const { ctx, config } = chart;
                // 从 config 中读取当前激活的 ID
                const activeId = config.activePlayerIndex;

                if (activeId === undefined || activeId === null) return;

                ctx.save();

                // 遍历两个数据集 (0:自评, 1:他评)
                chart.data.datasets.forEach((dataset, datasetIndex) => {
                    const meta = chart.getDatasetMeta(datasetIndex);

                    meta.data.forEach((point, index) => {
                        const raw = dataset.data[index];
                        // 只有当前选中的选手才发光
                        if (raw && raw.pIndex === activeId) {
                            const { x, y } = point.getProps(['x', 'y'], true);

                            // 设置光晕样式
                            if (datasetIndex === 0) {
                                // 自评 (金色光晕，强)
                                ctx.shadowColor = '#C5A059';
                                ctx.shadowBlur = 20;
                                ctx.fillStyle = '#C5A059';
                            } else {
                                // 他评 (白色光晕，柔和)
                                ctx.shadowColor = 'rgba(255, 255, 255, 0.8)';
                                ctx.shadowBlur = 15;
                                ctx.fillStyle = '#ffffff';
                            }

                            // 绘制发光体 (在原始点背后画一个形状)
                            ctx.beginPath();
                            if (datasetIndex === 0) {
                                // 菱形 (对应 rectRot)
                                const size = 6;
                                ctx.moveTo(x, y - size);
                                ctx.lineTo(x + size, y);
                                ctx.lineTo(x, y + size);
                                ctx.lineTo(x - size, y);
                            } else {
                                // 圆形
                                ctx.arc(x, y, 4, 0, 2 * Math.PI);
                            }
                            ctx.closePath();
                            ctx.fill();
                        }
                    });
                });

                ctx.restore();
            }
        };

        // 基础颜色逻辑
        const getColor = (context, isSelf) => {
            const raw = context.raw;
            if (!raw) return 'transparent';
            const isActive = raw.pIndex === currentId;
            if (isSelf) return isActive ? '#C5A059' : 'rgba(197, 160, 89, 0.15)';
            else return isActive ? '#e0e0e0' : 'rgba(255, 255, 255, 0.1)';
        };

        if (scatterChart) {
            // === 更新模式 ===

            // 1. 传递最新的选中ID给 chart config，供插件读取
            scatterChart.config.activePlayerIndex = currentId;

            // 2. 更新数据
            scatterChart.data.datasets[0].data = allSelfPoints;
            scatterChart.data.datasets[1].data = allOtherPoints;

            // 3. 重新绑定颜色函数 (确保非发光部分的颜色也正确)
            scatterChart.data.datasets[0].pointBackgroundColor = (c) => getColor(c, true);
            scatterChart.data.datasets[1].pointBackgroundColor = (c) => getColor(c, false);

            scatterChart.update();
        } else {
            // === 初始化模式 ===
            Chart.register(glowPlugin); // 注册插件

            scatterChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [
                        {
                            label: '自评定位',
                            data: allSelfPoints,
                            pointBackgroundColor: (c) => getColor(c, true),
                            borderWidth: 0, // 取消描边，让光晕更纯粹
                            pointRadius: 6,
                            pointStyle: 'rectRot'
                        },
                        {
                            label: '队友眼中的你',
                            data: allOtherPoints,
                            pointBackgroundColor: (c) => getColor(c, false),
                            borderWidth: 0,
                            pointRadius: 4
                        }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    layout: { padding: 10 },
                    // 将 activePlayerIndex 挂载在 options 根部或者 config 根部均可，这里配合插件逻辑
                    activePlayerIndex: currentId,
                    scales: {
                        x: {
                            min: 0, max: 10,
                            grid: {
                                color: (c) => c.tick.value === 5 ? 'rgba(255,255,255,0.15)' : 'rgba(255,255,255,0.02)',
                                lineWidth: (c) => c.tick.value === 5 ? 1 : 1
                            },
                            ticks: { display: false }, border: { display: false }
                        },
                        y: {
                            min: 0, max: 10,
                            grid: {
                                color: (c) => c.tick.value === 5 ? 'rgba(255,255,255,0.15)' : 'rgba(255,255,255,0.02)',
                                lineWidth: (c) => c.tick.value === 5 ? 1 : 1
                            },
                            ticks: { display: false }, border: { display: false }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top', align: 'end',
                            labels: { color: '#707570', boxWidth: 6, font: { size: 10, family: "'Noto Serif SC', serif" } }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0,0,0,0.8)',
                            titleColor: '#C5A059',
                            bodyColor: '#fff',
                            callbacks: {
                                label: function(context) {
                                    const pId = playersData[context.raw.pIndex].id.split(' ')[0];
                                    return `${pId}: (${context.raw.x}, ${context.raw.y})`;
                                }
                            }
                        }
                    }
                }
            });
        }
    }
    function updateDetails(player) {
        const allDims = [
            ...player.abilities.map(a => ({self: a.self, others: a.others})),
            {self: player.profile.tightness.self, others: player.profile.tightness.others},
            {self: player.profile.aggression.self, others: player.profile.aggression.others}
        ];

        allDims.forEach((item, i) => {
            const avg = (item.others.reduce((a,b)=>a+b,0) / item.others.length);
            const gap = Math.abs(item.self - avg);

            const selfDot = document.getElementById(`row-${i}-self`);
            if(selfDot) selfDot.style.left = (item.self / 10) * 100 + '%';

            for(let k=0; k<20; k++) {
                const p = document.getElementById(`row-${i}-peer-${k}`);
                if(p) p.style.display = 'none';
            }
            item.others.forEach((val, j) => {
                const peerDot = document.getElementById(`row-${i}-peer-${j}`);
                if (peerDot) {
                    peerDot.style.display = 'block';
                    const jitter = (Math.random() - 0.5) * 1.5;
                    const safeVal = Math.max(0, Math.min(100, (val/10)*100 + jitter));
                    peerDot.style.left = safeVal + '%';
                }
            });

            const elSelf = document.getElementById(`row-${i}-val-self`);
            const elOther = document.getElementById(`row-${i}-val-other`);
            const elDiff = document.getElementById(`row-${i}-val-diff`);

            // 简单的数字更新，不再滚动
            elSelf.innerText = item.self;
            elOther.innerText = avg.toFixed(1);
            elDiff.innerText = gap.toFixed(1);
        });
    }

    // 初始化
    updateDashboard(0);

</script>
</body>
</html>