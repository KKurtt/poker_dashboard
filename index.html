<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GPC Poker League èƒ½åŠ›åˆ†æ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-color: #0a0a0a;
            --card-bg: #141414;
            --gold-primary: #D4AF37;
            --gold-light: #F4C430;
            --gold-dim: rgba(212, 175, 55, 0.1);
            --text-main: #e0e0e0;
            --text-sub: #888;
            --header-height: 60px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Helvetica Neue', Helvetica, 'PingFang SC', 'Microsoft YaHei', Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            line-height: 1.6;
            overflow-x: hidden;
            padding-bottom: 80px;
        }

        body::before {
            content: "";
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at 50% 0%, #2a2a2a 0%, #0a0a0a 80%);
            z-index: -1;
        }

        /* --- é¡¶éƒ¨æ‚¬æµ®æ  --- */
        .sticky-header {
            position: fixed; top: 0; left: 0; width: 100%; height: var(--header-height);
            background: rgba(15, 15, 15, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid #333;
            z-index: 1000;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 20px;
            transform: translateY(-100%);
            transition: transform 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            box-shadow: 0 5px 20px rgba(0,0,0,0.5);
        }
        .sticky-header.visible { transform: translateY(0); }

        .sticky-title { font-size: 1rem; font-weight: bold; color: var(--gold-primary); display: none; }
        @media (min-width: 600px) { .sticky-title { display: block; } }

        .sticky-select-wrapper { flex-grow: 1; display: flex; justify-content: flex-end; }
        .sticky-select {
            background: #222; color: var(--gold-light); border: 1px solid #444;
            padding: 5px 15px; border-radius: 4px; font-size: 0.9rem; outline: none;
        }

        /* --- ä¸»å®¹å™¨ --- */
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }

        header { text-align: center; margin-bottom: 30px; padding-top: 20px; transition: opacity 0.3s; }
        h1 {
            font-size: 1.8rem; color: var(--gold-primary); text-transform: uppercase;
            letter-spacing: 2px; margin-bottom: 5px;
            text-shadow: 0 0 15px rgba(212, 175, 55, 0.3);
        }
        @media (min-width: 768px) { h1 { font-size: 2.2rem; } }
        .subtitle { color: var(--text-sub); font-size: 0.9rem; letter-spacing: 1px; margin-bottom: 20px; }

        /* ä¸»é€‰æ‹©å™¨ */
        .selector-wrapper { display: flex; justify-content: center; margin-bottom: 30px; position: relative; z-index: 10; }
        .custom-select { position: relative; width: 100%; max-width: 300px; }
        .custom-select select {
            appearance: none; -webkit-appearance: none; width: 100%; font-size: 1rem;
            padding: 12px 20px; background-color: rgba(20, 20, 20, 0.9);
            border: 1px solid var(--gold-primary); border-radius: 4px; color: var(--gold-primary);
            cursor: pointer; outline: none; box-shadow: 0 0 10px rgba(0,0,0,0.5);
            transition: all 0.3s; text-align: center; font-weight: bold;
        }
        .custom-select::after {
            content: 'â–¼'; font-size: 0.8rem; color: var(--gold-primary);
            position: absolute; right: 15px; top: 50%; transform: translateY(-50%); pointer-events: none;
        }

        /* --- ä»ªè¡¨ç›˜å¸ƒå±€ (è‡ªé€‚åº”å…³é”®) --- */
        .dashboard {
            display: grid;
            grid-template-columns: 1fr; /* ç§»åŠ¨ç«¯é»˜è®¤å•æ ï¼Œå®½åº¦è‡ªé€‚åº” */
            gap: 20px;
        }
        @media (min-width: 900px) {
            .dashboard { grid-template-columns: 1fr 1fr; gap: 30px; } /* PCç«¯åŒæ  */
            .full-width { grid-column: span 2; }
        }

        .card {
            background: var(--card-bg); border: 1px solid #222; padding: 20px;
            border-radius: 8px; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            position: relative; overflow: visible;
        }
        .card::after {
            content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 2px;
            background: linear-gradient(90deg, transparent, var(--gold-primary), transparent);
        }
        .card-title {
            color: var(--gold-light); font-size: 1.1rem; margin-bottom: 20px;
            border-bottom: 1px solid #333; padding-bottom: 10px;
            display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 5px;
        }
        .card-sub { font-size: 0.75rem; color: #666; font-weight: normal; }

        .rolling-number { display: inline-block; min-width: 1.5em; text-align: right; font-variant-numeric: tabular-nums; }

        .chart-container { position: relative; height: 300px; width: 100%; }
        @media (min-width: 768px) { .chart-container { height: 350px; } }

        .scatter-wrapper { position: relative; height: 300px; width: 100%; padding: 20px; margin-top: 10px; }
        @media (min-width: 768px) { .scatter-wrapper { height: 350px; } }

        .quadrant-label {
            position: absolute; font-size: 0.8rem; font-weight: bold; color: var(--text-sub);
            pointer-events: none; text-transform: uppercase;
        }
        .q-top { top: -10px; left: 50%; transform: translateX(-50%); color: var(--gold-light); }
        .q-bottom { bottom: -10px; left: 50%; transform: translateX(-50%); color: #aaa; }
        .q-left { left: -10px; top: 50%; transform: translateY(-50%); color: #aaa; }
        .q-right { right: -10px; top: 50%; transform: translateY(-50%); color: var(--gold-light); }

        /* --- è¯„åˆ†ç»†èŠ‚ (ä¸¤è¡Œæ’ç‰ˆä¼˜åŒ–) --- */
        .detail-rows { display: flex; flex-direction: column; gap: 20px; }

        .detail-row {
            display: flex; flex-direction: column;
            border-bottom: 1px solid #1a1a1a;
            padding-bottom: 10px;
        }

        .row-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 8px;
        }

        .d-label { font-size: 0.95rem; color: var(--text-main); font-weight: 500; }
        .d-stats { font-size: 0.8rem; color: #666; font-family: 'Courier New', monospace; }
        .stat-item { display: inline-block; margin-left: 10px; }
        .stat-val { color: #ccc; font-weight: bold; display: inline-block; min-width: 20px; text-align: right; }
        .stat-gap { color: var(--gold-primary); display: inline-block; min-width: 20px; text-align: right; }

        .d-track-container {
            position: relative; width: 100%; height: 16px;
            display: flex; align-items: center;
        }

        .d-track-line {
            width: 100%; height: 2px; background: #2a2a2a; border-radius: 2px;
        }

        .detail-point {
            position: absolute; top: 50%; border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: left 1.2s cubic-bezier(0.25, 1, 0.5, 1);
        }

        .detail-point.peer {
            width: 6px; height: 6px;
            background-color: rgba(255, 255, 255, 0.2);
            box-shadow: 0 0 4px rgba(255, 255, 255, 0.3);
            mix-blend-mode: screen;
            z-index: 1;
        }

        .detail-point.self {
            width: 10px; height: 10px;
            background: var(--gold-primary);
            border: none;
            z-index: 2;
            box-shadow: 0 0 6px var(--gold-primary);
        }

        .ai-advice { font-size: 0.95rem; color: #ccc; line-height: 1.8; }
        /* å…è®¸ç”¨æˆ·åœ¨å»ºè®®ä¸­ä½¿ç”¨HTMLæ ‡ç­¾ï¼Œè¿™é‡Œå®šä¹‰ä¸€äº›åŸºç¡€æ ·å¼ */
        .ai-advice strong { color: var(--gold-light); font-weight: bold; }
        .ai-advice p { margin-bottom: 10px; }
        .ai-advice ul { padding-left: 20px; margin-bottom: 10px; }
        .ai-advice li { margin-bottom: 5px; }

    </style>
</head>
<body>

<!-- é¡¶éƒ¨æ‚¬æµ®æ  -->
<div class="sticky-header" id="stickyHeader">
    <div class="sticky-title">GPC POKER LEAGUE</div>
    <div class="sticky-select-wrapper">
        <select id="stickyPlayerSelect" class="sticky-select"></select>
    </div>
</div>

<div class="container">
    <header id="mainHeader">
        <h1>GPC POKER LEAGUE</h1>
        <div class="subtitle">å¾·å·æ‰‘å…‹æˆ˜é˜Ÿèƒ½åŠ›è¯„ä¼°</div>
    </header>

    <div class="selector-wrapper">
        <div class="custom-select">
            <select id="playerSelect"></select>
        </div>
    </div>

    <div class="dashboard" id="dashboard">

        <!-- 1. é›·è¾¾å›¾ -->
        <div class="card">
            <div class="card-title">
                ç»¼åˆèƒ½åŠ›é›·è¾¾
                <span class="card-sub"></span>
            </div>
            <div class="chart-container">
                <canvas id="radarChart"></canvas>
            </div>
        </div>

        <!-- 2. è±¡é™å›¾ -->
        <div class="card">
            <div class="card-title">
                é€‰æ‰‹ç”»åƒå®šä½
                <span class="card-sub"></span>
            </div>
            <div class="scatter-wrapper">
                <div class="quadrant-label q-top">ç´§</div>
                <div class="quadrant-label q-bottom">æ¾</div>
                <div class="quadrant-label q-left">å¼±</div>
                <div class="quadrant-label q-right">å‡¶</div>
                <canvas id="scatterChart"></canvas>
            </div>
            <div id="profileText" style="margin-top:20px; text-align:center; color:var(--gold-light); font-weight:bold; font-size: 1rem; min-height: 1.6em;">
                <!-- JS å¡«å…… -->
            </div>
        </div>

        <!-- 3. è¯„åˆ†ç»†èŠ‚ -->
        <div class="card full-width">
            <div class="card-title">
                è¯„åˆ†åˆ†å¸ƒç»†èŠ‚
                <span class="card-sub">
                    è®¤çŸ¥åå·®(MAE): <span id="maeValue" class="rolling-number" style="color:var(--gold-primary); font-weight:bold; font-size:1rem;">0.0</span>
                </span>
            </div>
            <div class="detail-rows" id="detailRows">
                <!-- JS åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>

        <!-- 4. AI å»ºè®® (å¯ç¼–è¾‘) -->
        <div class="card full-width">
            <div class="card-title">AI æˆ˜æœ¯é¡¾é—®å»ºè®®</div>
            <div class="ai-advice" id="aiAdvice"></div>
        </div>

    </div>
</div>

<script>
    // ============================================================================
    // âš ï¸âš ï¸âš ï¸ æ•°æ®é…ç½®åŒºåŸŸ (åœ¨æ­¤å¤„å¡«å…¥æ‚¨ä»Geminiè·å–çš„çœŸå®æ•°æ®) âš ï¸âš ï¸âš ï¸
    // ============================================================================

    const dimensions = ["èŒƒå›´æ„å»º", "é”¦æ ‡èµ›ICM", "æ¿€è¿›å·ç›²", "è¯»ç‰Œèƒ½åŠ›", "æ•°å­¦ç†è®º", "å¿ƒæ€è€åŠ›"];

    // æ ¼å¼è¯´æ˜ï¼š
    // id: é€‰æ‰‹åå­—
    // abilities: å¯¹åº”ä¸Šé¢ dimensions çš„é¡ºåºã€‚selfæ˜¯è‡ªè¯„(0-10)ï¼Œothersæ˜¯é˜Ÿå‹è¯„åˆ†æ•°ç»„(0-10)
    // profile: æ¾ç´§(tightness) å’Œ æ¿€è¿›(aggression)ã€‚
    // aiAdvice: ç›´æ¥å¡«å…¥Geminiç»™å‡ºçš„å»ºè®®HTMLå­—ç¬¦ä¸²ã€‚æ”¯æŒ <p>, <strong>, <br> ç­‰æ ‡ç­¾ã€‚

    const playersData = [
        {
            id: "é˜Ÿé•¿ (Captain)",
            abilities: [
                { self: 9, others: [8, 9, 9, 8, 8, 9] }, // èŒƒå›´æ„å»º
                { self: 8, others: [7, 8, 8, 7, 8, 8] }, // é”¦æ ‡èµ›ICM
                { self: 7, others: [6, 7, 7, 6, 8, 7] }, // æ¿€è¿›å·ç›²
                { self: 9, others: [9, 9, 8, 9, 9, 8] }, // è¯»ç‰Œèƒ½åŠ›
                { self: 8, others: [8, 8, 8, 8, 8, 8] }, // æ•°å­¦ç†è®º
                { self: 9, others: [9, 9, 9, 9, 9, 9] }  // å¿ƒæ€è€åŠ›
            ],
            profile: {
                tightness: { self: 7, others: [6, 7, 7, 6, 7, 7] },
                aggression: { self: 6, others: [5, 6, 6, 5, 6, 6] }
            },
            aiAdvice: `
                <p><strong>ğŸ¤– ç»¼åˆè¯„ä»·ï¼š</strong>ä½œä¸ºé˜Ÿé•¿ï¼Œä½ çš„åŸºç¡€éå¸¸æ‰å®ï¼Œå°¤å…¶åœ¨<strong>å¿ƒæ€è€åŠ›</strong>å’Œ<strong>è¯»ç‰Œèƒ½åŠ›</strong>ä¸Šå¾—åˆ°äº†å…¨é˜Ÿçš„é«˜åº¦è®¤å¯ã€‚MAEæä½ï¼Œè¯´æ˜è‡ªæˆ‘è®¤çŸ¥æ¸…æ™°ã€‚</p>
                <p><strong>ğŸ’¡ æˆ˜æœ¯å»ºè®®ï¼š</strong></p>
                <ul>
                    <li>ä½ çš„å·ç›²é¢‘ç‡åœ¨é˜Ÿå‹çœ¼ä¸­ç•¥æ˜¾ä¿å®ˆï¼ˆ6-7åˆ†ï¼‰ï¼Œåœ¨é”¦æ ‡èµ›åæœŸå¯ä»¥å°è¯•æ›´å®½çš„å†åŠ æ³¨èŒƒå›´ã€‚</li>
                    <li>å½¢è±¡åå‘â€œç´§å‡¶â€ï¼Œåˆ©ç”¨è¿™ä¸ªå½¢è±¡åœ¨ç¿»ç‰Œå‰è¿›è¡Œæ›´å¤šçš„3-betè¯ˆå”¬ã€‚</li>
                </ul>
            `
        },
        {
            id: "æ¿€è¿›æ´¾ (Tom)",
            abilities: [
                { self: 8, others: [6, 7, 5, 6, 7, 6] },
                { self: 6, others: [5, 5, 6, 5, 5, 6] },
                { self: 10, others: [9, 10, 9, 10, 9, 10] },
                { self: 7, others: [5, 6, 5, 6, 5, 6] },
                { self: 5, others: [4, 5, 5, 4, 5, 5] },
                { self: 6, others: [4, 5, 4, 5, 4, 5] }
            ],
            profile: {
                tightness: { self: 3, others: [2, 3, 2, 3, 2, 3] }, // å¾ˆæ¾
                aggression: { self: 9, others: [9, 10, 9, 10, 9, 10] } // å¾ˆå‡¶
            },
            aiAdvice: `
                <p><strong>ğŸ¤– ç»¼åˆè¯„ä»·ï¼š</strong>å…¸å‹çš„<strong>LAGï¼ˆæ¾å‡¶ï¼‰</strong>é£æ ¼ã€‚ä½ çš„ä¾µç•¥æ€§æ˜¯æ­¦å™¨ï¼Œä½†ç›®å‰çš„è®¤çŸ¥åå·®ï¼ˆMAEï¼‰è¾ƒé«˜ï¼Œä½ é«˜ä¼°äº†è‡ªå·±çš„è¯»ç‰Œå’ŒèŒƒå›´æ„å»ºèƒ½åŠ›ã€‚</p>
                <p><strong>âš ï¸ é£é™©æç¤ºï¼š</strong></p>
                <p>é˜Ÿå‹æ™®éè®¤ä¸ºä½ çš„æ•°å­¦ç†è®ºåŸºç¡€è–„å¼±ã€‚å»ºè®®å¤ç›˜æ—¶å¤šä½¿ç”¨GTO Wizardæ£€æŸ¥è‡ªå·±çš„è¯ˆå”¬é¢‘ç‡æ˜¯å¦å¹³è¡¡ï¼Œé¿å…è¿‡åº¦æ“ä½œå¯¼è‡´é€ç­¹ç ã€‚</p>
            `
        },
        {
            id: "æ–°æ‰‹ (Rookie)",
            abilities: [
                { self: 5, others: [6, 6, 7, 6, 6, 7] },
                { self: 4, others: [5, 5, 6, 5, 5, 6] },
                { self: 5, others: [4, 5, 4, 5, 4, 5] },
                { self: 6, others: [6, 7, 6, 7, 6, 7] },
                { self: 7, others: [8, 9, 8, 9, 8, 9] },
                { self: 5, others: [6, 7, 6, 7, 6, 7] }
            ],
            profile: {
                tightness: { self: 8, others: [8, 9, 8, 9, 8, 9] },
                aggression: { self: 3, others: [2, 3, 2, 3, 2, 3] }
            },
            aiAdvice: `
                <p><strong>ğŸ¤– ç»¼åˆè¯„ä»·ï¼š</strong>ä½ æœ‰äº›<strong>å†’å……è€…ç»¼åˆå¾ï¼ˆImposter Syndromeï¼‰</strong>ï¼Œä½ çš„è‡ªè¯„æ™®éä½äºé˜Ÿå‹è¯„åˆ†ï¼Œå°¤å…¶æ˜¯æ•°å­¦èƒ½åŠ›ã€‚ä½ æ¯”è‡ªå·±æƒ³è±¡çš„è¦å¼ºï¼</p>
                <p><strong>ğŸš€ æ”¹è¿›æ–¹å‘ï¼š</strong></p>
                <p>ä½ çš„é£æ ¼è¿‡äºè¢«åŠ¨ï¼ˆå²©çŸ³å‹ï¼‰ã€‚ä¸è¦åªåœ¨æ‹¿åˆ°åšæœæ—¶æ‰åŠ æ³¨ï¼Œå°è¯•åœ¨æœ‰åˆ©ä½ç½®ç”¨åŒèŠ±è¿å¼ è¿›è¡Œéš”ç¦»åŠ æ³¨ã€‚</p>
            `
        }
    ];

    // ============================================================================
    // é€»è¾‘ä»£ç  (ä»¥ä¸‹éƒ¨åˆ†æ— éœ€ä¿®æ”¹)
    // ============================================================================

    // è®¡ç®—å…¨é˜Ÿå¹³å‡å€¼ (ç”¨äºé›·è¾¾å›¾èƒŒæ™¯)
    const teamAverages = dimensions.map((_, idx) => {
        let sum = 0, count = 0;
        playersData.forEach(p => {
            // ç´¯åŠ è‡ªè¯„
            sum += p.abilities[idx].self;
            count++;
            // ç´¯åŠ ä»–è¯„
            p.abilities[idx].others.forEach(v => {
                sum += v;
                count++;
            });
        });
        return (sum / count).toFixed(1);
    });

    // --- åŠ¨ç”»å·¥å…· ---
    function animateValue(obj, start, end, duration) {
        if (!obj) return;
        let startTimestamp = null;
        const step = (timestamp) => {
            if (!startTimestamp) startTimestamp = timestamp;
            const progress = Math.min((timestamp - startTimestamp) / duration, 1);
            const easeProgress = 1 - Math.pow(1 - progress, 4);
            const currentVal = (start + (end - start) * easeProgress);

            if (Number.isInteger(end) && Number.isInteger(start)) {
                obj.innerText = Math.round(currentVal);
            } else {
                obj.innerText = currentVal.toFixed(1);
            }

            if (progress < 1) {
                window.requestAnimationFrame(step);
            } else {
                obj.innerText = Number.isInteger(end) ? end : end.toFixed(1);
            }
        };
        window.requestAnimationFrame(step);
    }

    // --- åˆå§‹åŒ–ä¸äº‹ä»¶ ---
    let radarChart = null;
    let scatterChart = null;
    const playerSelect = document.getElementById('playerSelect');
    const stickySelect = document.getElementById('stickyPlayerSelect');
    const stickyHeader = document.getElementById('stickyHeader');
    const mainHeader = document.getElementById('mainHeader');
    const detailRows = document.getElementById('detailRows');
    const aiAdvice = document.getElementById('aiAdvice');
    const profileText = document.getElementById('profileText');
    const maeValueDisplay = document.getElementById('maeValue');

    // å¡«å……ä¸‹æ‹‰èœå•
    function populateSelects() {
        playersData.forEach((p, index) => {
            const opt1 = document.createElement('option');
            opt1.value = index;
            opt1.innerText = p.id;
            playerSelect.appendChild(opt1);

            const opt2 = document.createElement('option');
            opt2.value = index;
            opt2.innerText = p.id;
            stickySelect.appendChild(opt2);
        });
    }
    populateSelects();

    function handlePlayerChange(index) {
        playerSelect.value = index;
        stickySelect.value = index;
        updateDashboard(playersData[index]);
    }

    playerSelect.addEventListener('change', (e) => handlePlayerChange(e.target.value));
    stickySelect.addEventListener('change', (e) => handlePlayerChange(e.target.value));

    // æ»šåŠ¨ç›‘å¬
    window.addEventListener('scroll', () => {
        const triggerHeight = mainHeader.offsetHeight + 20;
        if (window.scrollY > triggerHeight) {
            stickyHeader.classList.add('visible');
        } else {
            stickyHeader.classList.remove('visible');
        }
    });

    Chart.defaults.color = '#888';
    Chart.defaults.borderColor = '#333';
    Chart.defaults.font.family = "'Helvetica Neue', 'PingFang SC', sans-serif";

    // åˆå§‹åŒ–ç»†èŠ‚è¡ŒDOM
    function initDetailRows() {
        const allLabels = [...dimensions, "æ¾ç´§å€¾å‘", "æ¿€è¿›å€¾å‘"];

        allLabels.forEach((label, i) => {
            const row = document.createElement('div');
            row.className = 'detail-row';
            row.dataset.index = i;

            const rowHeader = document.createElement('div');
            rowHeader.className = 'row-header';

            const labelDiv = document.createElement('div');
            labelDiv.className = 'd-label';
            labelDiv.innerText = label;

            const statsDiv = document.createElement('div');
            statsDiv.className = 'd-stats';
            statsDiv.innerHTML = `
                <span class="stat-item">è‡ª:<span class="stat-val" id="row-${i}-val-self">0</span></span>
                <span class="stat-item">ä»–:<span class="stat-val" id="row-${i}-val-other">0</span></span>
                <span class="stat-item">å·®:<span class="stat-gap" id="row-${i}-val-diff">0</span></span>
            `;

            rowHeader.appendChild(labelDiv);
            rowHeader.appendChild(statsDiv);

            const trackContainer = document.createElement('div');
            trackContainer.className = 'd-track-container';
            const line = document.createElement('div');
            line.className = 'd-track-line';
            trackContainer.appendChild(line);

            // é¢„å…ˆåˆ›å»ºç‚¹ (å‡è®¾æœ€å¤š20ä¸ªé˜Ÿå‹è¯„åˆ†ï¼Œä¸å¤Ÿçš„éšè—)
            for(let j=0; j<20; j++) {
                const p = document.createElement('div');
                p.className = 'detail-point peer';
                p.id = `row-${i}-peer-${j}`;
                p.style.display = 'none'; // é»˜è®¤éšè—
                p.style.left = '50%';
                trackContainer.appendChild(p);
            }
            const selfP = document.createElement('div');
            selfP.className = 'detail-point self';
            selfP.id = `row-${i}-self`;
            selfP.style.left = '50%';
            trackContainer.appendChild(selfP);

            row.appendChild(rowHeader);
            row.appendChild(trackContainer);
            detailRows.appendChild(row);
        });
    }

    initDetailRows();

    function updateDashboard(player) {
        updateRadar(player);
        updateScatter(player);
        updateDetails(player);
        // ç›´æ¥æ¸²æŸ“é…ç½®å¥½çš„HTMLå»ºè®®
        aiAdvice.innerHTML = player.aiAdvice;
    }

    function updateRadar(player) {
        const ctx = document.getElementById('radarChart').getContext('2d');
        const selfData = player.abilities.map(a => a.self);
        const otherAvgData = player.abilities.map(a => (a.others.reduce((x,y)=>x+y,0)/a.others.length).toFixed(1));
        const gradientSelf = ctx.createRadialGradient(200, 200, 0, 200, 200, 200);
        gradientSelf.addColorStop(0, 'rgba(212, 175, 55, 0.6)');
        gradientSelf.addColorStop(1, 'rgba(212, 175, 55, 0.1)');

        if (radarChart) {
            radarChart.data.datasets[0].data = selfData;
            radarChart.data.datasets[1].data = otherAvgData;
            radarChart.update({ duration: 1000, easing: 'easeInOutQuart' });
        } else {
            radarChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: dimensions,
                    datasets: [
                        {
                            label: 'è‡ªè¯„',
                            data: selfData,
                            borderColor: '#D4AF37',
                            backgroundColor: gradientSelf,
                            borderWidth: 2,
                            pointBackgroundColor: '#D4AF37',
                            pointRadius: 3
                        },
                        {
                            label: 'ä»–è¯„',
                            data: otherAvgData,
                            borderColor: '#aaa',
                            backgroundColor: 'rgba(255,255,255,0.02)',
                            borderDash: [4, 4],
                            borderWidth: 1,
                            pointBackgroundColor: '#aaa',
                            pointRadius: 2
                        },
                        {
                            label: 'æˆ˜é˜Ÿå¹³å‡',
                            data: teamAverages,
                            borderColor: 'transparent',
                            backgroundColor: 'rgba(50, 50, 50, 0.3)',
                            pointRadius: 0,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    scales: {
                        r: {
                            angleLines: { color: '#333' },
                            grid: { color: '#222', lineWidth: 1 },
                            pointLabels: { color: '#ccc', font: { size: 12 } },
                            suggestedMin: 0, suggestedMax: 10, ticks: { display: false }
                        }
                    },
                    plugins: { legend: { labels: { color: '#aaa' } } }
                }
            });
        }
    }

    function updateScatter(player) {
        const ctx = document.getElementById('scatterChart').getContext('2d');
        const avgTight = player.profile.tightness.others.reduce((a,b)=>a+b,0) / player.profile.tightness.others.length;
        const avgAgg = player.profile.aggression.others.reduce((a,b)=>a+b,0) / player.profile.aggression.others.length;

        const getLabel = (t, a) => {
            let tLabel = t > 6.5 ? "ç´§" : (t < 4.5 ? "æ¾" : "ä¸­æ€§");
            let aLabel = a > 6.5 ? "å‡¶" : (a < 4.5 ? "å¼±" : "ä¸­æ€§");
            if (tLabel === "ä¸­æ€§" && aLabel === "ä¸­æ€§") return "å¹³è¡¡å‹é€‰æ‰‹";
            if (tLabel === "ç´§" && aLabel === "å‡¶") return "ç´§å‡¶å‹ (TAG)";
            if (tLabel === "æ¾" && aLabel === "å‡¶") return "æ¾å‡¶å‹ (LAG)";
            if (tLabel === "ç´§" && aLabel === "å¼±") return "å²©çŸ³å‹ (Nit)";
            if (tLabel === "æ¾" && aLabel === "å¼±") return "æ¾å¼±å‹ (Fish)";
            return `${tLabel}${aLabel}å€¾å‘`;
        };

        profileText.style.opacity = 0;
        setTimeout(() => {
            profileText.innerText = `ç»¼åˆç”»åƒåˆ¤å®šï¼š${getLabel(avgTight, avgAgg)}`;
            profileText.style.transition = 'opacity 0.5s';
            profileText.style.opacity = 1;
        }, 200);

        if (scatterChart) {
            scatterChart.data.datasets[0].data = [{x: player.profile.tightness.self, y: player.profile.aggression.self}];
            scatterChart.data.datasets[1].data = [{x: avgTight, y: avgAgg}];
            scatterChart.update({ duration: 1200, easing: 'easeInOutQuart' });
        } else {
            scatterChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [
                        {
                            label: 'è‡ªè¯„å®šä½',
                            data: [{x: player.profile.tightness.self, y: player.profile.aggression.self}],
                            backgroundColor: '#D4AF37', borderColor: 'transparent', borderWidth: 0, pointRadius: 6
                        },
                        {
                            label: 'é˜Ÿå‹çœ¼ä¸­çš„ä½ ',
                            data: [{x: avgTight, y: avgAgg}],
                            backgroundColor: '#fff', borderColor: '#D4AF37', borderWidth: 1, pointRadius: 6
                        }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    layout: { padding: 10 },
                    scales: {
                        x: { min: 0, max: 11, grid: { color: c=>c.tick.value===5.5?'#444':'#222', lineWidth: c=>c.tick.value===5.5?1:0.5 }, ticks: {display:false} },
                        y: { min: 0, max: 11, grid: { color: c=>c.tick.value===5.5?'#444':'#222', lineWidth: c=>c.tick.value===5.5?1:0.5 }, ticks: {display:false} }
                    },
                    plugins: { legend: { position: 'bottom', labels: { color: '#aaa' } } }
                }
            });
        }
    }

    function updateDetails(player) {
        const allDims = [
            ...player.abilities.map(a => ({self: a.self, others: a.others})),
            {self: player.profile.tightness.self, others: player.profile.tightness.others},
            {self: player.profile.aggression.self, others: player.profile.aggression.others}
        ];

        let totalError = 0;
        allDims.forEach(d => {
            const avg = d.others.reduce((a,b)=>a+b,0)/d.others.length;
            totalError += Math.abs(d.self - avg);
        });
        const mae = totalError / allDims.length;

        const oldMae = parseFloat(maeValueDisplay.innerText) || 0;
        animateValue(maeValueDisplay, oldMae, mae, 1000);

        allDims.forEach((item, i) => {
            const avg = (item.others.reduce((a,b)=>a+b,0) / item.others.length);
            const gap = Math.abs(item.self - avg);

            const selfDot = document.getElementById(`row-${i}-self`);
            if(selfDot) selfDot.style.left = (item.self / 10) * 100 + '%';

            // é‡ç½®æ‰€æœ‰ç‚¹
            for(let k=0; k<20; k++) {
                const p = document.getElementById(`row-${i}-peer-${k}`);
                if(p) p.style.display = 'none';
            }

            item.others.forEach((val, j) => {
                const peerDot = document.getElementById(`row-${i}-peer-${j}`);
                if (peerDot) {
                    peerDot.style.display = 'block';
                    const jitter = (Math.random() - 0.5) * 1.5;
                    const safeVal = Math.max(0, Math.min(100, (val/10)*100 + jitter));
                    peerDot.style.left = safeVal + '%';
                }
            });

            const elSelf = document.getElementById(`row-${i}-val-self`);
            const elOther = document.getElementById(`row-${i}-val-other`);
            const elDiff = document.getElementById(`row-${i}-val-diff`);

            const prevSelf = parseFloat(elSelf.innerText) || 0;
            const prevOther = parseFloat(elOther.innerText) || 0;
            const prevDiff = parseFloat(elDiff.innerText) || 0;

            animateValue(elSelf, prevSelf, item.self, 800);
            animateValue(elOther, prevOther, avg, 800);
            animateValue(elDiff, prevDiff, gap, 800);
        });
    }

    // å¯åŠ¨
    updateDashboard(playersData[0]);

</script>
</body>
</html>